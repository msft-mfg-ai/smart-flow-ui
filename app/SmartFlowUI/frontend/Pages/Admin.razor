@page "/admin"

<PageTitle>Admin</PageTitle>

<MudText Typo="Typo.h2" Style="margin-bottom: 30px;">Admin Settings</MudText>

<MudGrid Justify="Justify.Center">
	<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Style="width: 97%;">

		<MudTabPanel Text="Endpoints" Icon="@Icons.Material.Filled.Api" BadgeData="@_profileInfo.Profiles.Count" BadgeColor="Color.Success">
			<MudCard Class="ma-1">
				<MudText Typo="Typo.h4">@_profileInfo.Keys.Count Endpoints Are Defined</MudText>
				<MudList T="string">
					@foreach (var key in _profileInfo.Keys)
					{
						if (key.APIEndpointSettingIsValid && key.APIEndpointKeySettingIsValid)
						{
							<MudListItem>
								<AvatarContent>
									<MudIcon Icon="@Icons.Material.Filled.Key" Title="Key Found!" Style="color: forestgreen;" />
								</AvatarContent>
								<ChildContent>
									<b>@key.ProfileName</b><br />
									@key.APIEndpointSettingValue
								</ChildContent>
							</MudListItem>
						}
						else
						{
							if (key.APIEndpointSettingIsValid && !key.APIEndpointKeySettingIsValid)
							{
								<MudListItem>
									<AvatarContent>
										<MudIcon Icon="@Icons.Material.Filled.HeartBroken" Title="Key is invalid!" Style="color: red;" />
									</AvatarContent>
									<ChildContent>
										<b>@key.ProfileName</b><br />
										@key.APIEndpointSettingValue<br />
										<i>Invalid Key is named <b>@key.APIEndpointKeySettingName</b></i>
									</ChildContent>
								</MudListItem>
							}
							else
							{
								<MudListItem>
									<AvatarContent>
										<MudIcon Icon="@Icons.Material.Filled.CallMissed" Title="No URL defined" Style="color: blueviolet;" />
									</AvatarContent>
									<ChildContent>
										<b>@key.ProfileName</b><br />
										No URL defined for this endpoint
									</ChildContent>
								</MudListItem>
							}
						}
					}
				</MudList>
				<MudText Typo="Typo.body2" Style="margin-left: 50px; color: gray">
					Legend:<br />
					<MudIcon Icon="@Icons.Material.Filled.CallMissed" Title="Key" Style="font-size: .8em; color: blueviolet;" /> No Endpoint URL defined<br />
					<MudIcon Icon="@Icons.Material.Filled.Key" Title="Key" Style="font-size: .8em; color: forestgreen;" /> Endpoint found with a key specified<br />
					<MudIcon Icon="@Icons.Material.Filled.HeartBroken" Style="font-size: .8em; color: red; " Title="HeartBroken" /> Endpoint found with but no key value found<br />
				</MudText>
			</MudCard>
		</MudTabPanel>

		<MudTabPanel Text="Profile Config" Icon="@Icons.Material.Filled.DataObject">
			<MudForm @ref="@_form">
				<MudText Typo="Typo.h4">Profile Data</MudText>
				<MudText>@_profileInfo.ProfileLoadingMessage</MudText>
				<MudButton StartIcon="@Icons.Material.Filled.ReplayCircleFilled" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Medium"
					Style="width: 300px; margin-bottom: 15px;"
					Disabled=@(!_profileInfo.Profiles.Any())
					OnClick="@(async _ => await ReloadProfileInfoAsync())">
					Reload Profile Data
				</MudButton>
				<MudTextField @bind-Value="_profileRawData" T="string" FullWidth AutoGrow Variant="Variant.Outlined" Style="font-family: Consolas;"
					Label="Raw Profile Data"></MudTextField>
			</MudForm>
		</MudTabPanel>

		<MudTabPanel Text="Help" Icon="@Icons.Material.Filled.Help">
			<MudCard Class="ma-1">
				<MudCardHeader>
					<CardHeaderContent>
						<MudText Typo="Typo.h4">Profile Configuration Help</MudText>
					</CardHeaderContent>
				</MudCardHeader>
				<MudCardContent>
					The prompts that are defined in the SmartFlow API should be represented in the UI as profiles.<br />
					<br />
					Profiles are originally defined in the Services/Profile/profiles.json file, which is embedded in the application.
					Once the UI is deployed, you can change the profiles defined by specifying one of two alternate locations for the profile data.
					In that way, you can update the profiles supplied without having to redeploy the application each time.
					<br /><br />
					The profiles are loaded in priority order, starting with the Storage Account, then looking for a ProfileConfiguration environment key, then defaulting finally to the <i>profiles.json</i> file if the two alternates are not defined.
					<br /><br />
					<b>1. Storage Account Profile</b>
					<br /><br />
					If you create an environment key named <b><i>ProfileConfigurationBlobStorageContainer</i></b>, the application will look in that container for a file named <i>profiles.json</i>.  This file will be used to override the profiles defined in the <i>profiles.json</i> file in the application.
					<br /><br />
					<b>2. Environment Key Profile</b>
					<br /><br />
					If you create an environment key named <b><i>ProfileConfiguration</i></b>, the application will use that data to override the profiles defined in the <i>profiles.json</i> file in the application. It is expected that the key value would contain a JSON string that is contains exactly what would be in the <i>profiles.json</i> file. However, that data must be Base 64 encoded as it will be Base64 decoded when it is read.
					Create your <i>profiles.json</i> file locally, then use a tool like <a href="https://base64.guru/converter/encode/text" target="_blank">https://base64.guru/converter/encode/text</a> (or some other tool you have access to) to encode the file.  Create an environment key named <i>ProfileConfiguration</i> and paste the Base 64 encoded string into the value.
				</MudCardContent>
			</MudCard>
		</MudTabPanel>

	</MudTabs>

	<MudScrollToTop Selector="#uploads" VisibleCssClass="visible absolute" HiddenCssClass="invisible">
		<MudFab Color="Color.Primary" IconSize="Size.Large" StartIcon="@Icons.Material.Filled.ArrowUpward" />
	</MudScrollToTop>
</MudGrid>
